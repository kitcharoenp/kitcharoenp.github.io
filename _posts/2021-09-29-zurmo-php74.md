---
layout : post
title : "Zurmo On PHP 7.4"
categories : [zurmo]
published : false
---

### php.ini
```
; How many GET/POST/COOKIE input variables may be accepted
; max_input_vars = 1000
;
; Fixed : member of groups is empty when edit group member
max_input_vars = 3000

; Fixed : Fatal error: Allowed memory size of 134217728 bytes exhausted (tried to allocate 20480 bytes)
memory_limit = -1
```

### Class
* comment `ini_set()` in **CHttpSession** [yii/framework]


### Database
* `globalmetadata` rename `MaterialsControl` classname

### ERROR
```log
Sep 24 12:34:35 xserver02 systemd-networkd-wait-online[494]: Event loop failed: Connection timed out
Sep 24 12:34:35 xserver02 systemd[1]: systemd-networkd-wait-online.service: Main process exited, code=exited, status=1/FAILURE
Sep 24 12:34:35 xserver02 systemd[1]: systemd-networkd-wait-online.service: Failed with result 'exit-code'.
Sep 24 12:34:35 xserver02 systemd[1]: Failed to start Wait for Network to be Configured.
```



```
audit: type=1400 audit(1632986733.064:374): apparmor="DENIED"
```


DROP PROCEDURE IF EXISTS
```
2021/09/29 09:06:10 [error] [exception.RedBean_Exception_SQL] [42000] - SQLSTATE[42000]: Syntax error or access violation: 1304 PROCEDURE get_group_inherited_actual_right_ignoring_everyone already exists
```


```
Syntax error or access violation: 1304 PROCEDURE get_group_inherited_actual_right_ignoring_everyone already exists

SQLSTATE[42000]: Syntax error or access violation: 1305 FUNCTION zurmo.get_securableitem_actual_permissions_for_permitable does not exist
```

```
SQLSTATE[42000]: Syntax error or access violation: 1304 FUNCTION get_permitable_explicit_actual_right already exists
```

SQLSTATE[42000]: Syntax error or access violation: 1304 PROCEDURE recursive_group_contains_user already exists


SQLSTATE[42000]: Syntax error or access violation: 1304 FUNCTION get_user_actual_right already exists

**Solution**

file: `ZurmoDatabaseCompatibilityUtil.php`
```
// Drop procedure if exists
'drop procedure if exists get_group_inherited_actual_right_ignoring_everyone;',
```
https://dba.stackexchange.com/questions/126312/is-there-an-alternative-to-create-or-replace-procedure-in-mysql

https://www.percona.com/doc/percona-server/8.0/management/udf_percona_toolkit.html

mysql -u root -pr^]grbj, -e "CREATE FUNCTION fnv1a_64 RETURNS INTEGER SONAME 'libfnv1a_udf.so'"
mysql: [Warning] Using a password on the command line interface can be insecure.

https://www.percona.com/doc/percona-server/8.0/installation/post-installation.html#secure-the-installation

sudo apt-get install percona-xtrabackup-80



xtrabackup --backup \
    --target-dir=/opt/perconaXtraBackup/for_replica \
    --user="root" \
    --password="r^]grbj," \
    --parallel=4 \
    --host=10.10.10.40